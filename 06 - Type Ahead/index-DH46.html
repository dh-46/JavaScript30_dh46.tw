<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
  // å¤–éƒ¨è³‡æ–™ JSONæ ¼å¼
  const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

  /*
    ä¸»è¦æµç¨‹
    1. å–å¾—å¤–éƒ¨è³‡æ–™
    2. å–å¾—ä½¿ç”¨è€…åœ¨å°è©±æ¡†è¼¸å…¥çš„æ–‡å­—å…§å®¹
    3. åˆ©ç”¨ä½¿ç”¨è€…è¼¸å…¥çš„æ–‡å­—ï¼Œéæ¿¾å‡ºé™£åˆ—ä¸­çš„ç­”æ¡ˆï¼Œä¸¦å‘ˆç¾åœ¨ç•«é¢ä¸Šã€‚
  */

  // æ‰¿æ¥å¤–éƒ¨è³‡æ–™
  const cities = [];

  // å–å¾—å¤–éƒ¨è³‡æ–™ fetch(); => ç€è¦½å™¨å…§å»ºAPI
  // fetch(); æœƒå›å‚³ä¸€å€‹ promise
  // const prom = fetch(endpoint);
  // console.log(prom);

  // ä½¿ç”¨.then() => https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise/then
  // é€™è£¡çš„blobåªæ˜¯wes boså®šçš„åƒæ•¸åç¨±ï¼Œä½†æ˜¯ä¸€èˆ¬çš„ Blobï¼ˆBinary Large Objectï¼‰ç‰©ä»¶ä»£è¡¨äº†ä¸€å€‹ç›¸ç•¶æ–¼æª”æ¡ˆï¼ˆåŸå§‹è³‡æ–™ï¼‰çš„ä¸å¯è®Šç‰©ä»¶ã€‚
  // fetchå›å‚³çš„æ˜¯Promiseç‰©ä»¶ï¼Œé€éthenæ–¹æ³•å›å‚³ä¸€å€‹Responseçš„åŸå§‹è³‡æ–™(raw data)ï¼Œè€Œé€™å€‹åŸå§‹è³‡æ–™å¯ä»¥æ˜¯image/music/json/...etc.
  // é‚£é€™é‚Šæˆ‘å€‘çŸ¥é“é ç«¯å›ä¾†çš„æ˜¯JSONï¼Œä¸éä¸èƒ½ç›´æ¥ä½¿ç”¨JSON.parseä¾†è§£æï¼Œå› ç‚ºå›å‚³å›ä¾†çš„ä¸¦ä¸æ˜¯çœŸæ­£æˆ‘å€‘è¦çš„JSON raw dataã€‚
  // è€Œæ˜¯è¦å†ä½¿ç”¨Response._prototye_.json()ï¼Œä¸¦ä¸”è©²æ–¹æ³•æœƒå†å›å‚³ä¸€å€‹Promiseï¼Œä¹‹å¾Œå†ä½¿ç”¨then()è®“å…¶callbackåƒæ•¸ï¼Œå›å‚³çœŸæ­£çš„é™£åˆ—dataã€‚

  /*
    è£œå……:
    å¦‚ä½•æŠŠdataçš„è³‡æ–™æ”¾é€²citiesé™£åˆ—?
    1. å› ç‚ºå®£å‘Šç‚ºconstæ‰€ä»¥ä¸èƒ½ç›´æ¥ cities = dataï¼Œè¦æ”¹citieså®£å‘Šç‚ºletã€‚
    2. ä½¿ç”¨cities.push? => æœƒè®ŠæˆäºŒç¶­é™£åˆ— cities = [[data],1,2,3,4];
        å› ç‚ºpushæ–¹æ³•æ˜¯å°‡è©²åƒæ•¸æ”¾å…¥é™£åˆ—ä¸­ã€‚
        è§£: ä½¿ç”¨ES6 Spread ... => cities.push(...data)
  */
  fetch(endpoint)
          .then(blob => blob.json())
          .then(data => cities.push(...data));

  /*
    åŸå§‹JSONè£¡çš„ç‰©ä»¶
    city: "New York"
    growth_from_2000_to_2013: "4.8%"
    latitude: 40.7127837
    longitude: -74.0059413
    population: "8405837"
    rank: "1"
    state: "New York"
  */

  // ç¯©é¸è³‡æ–™çš„æ–¹æ³•
  // å‚³å…¥è¦ç¯©é¸çš„å–®å­—èˆ‡åŸå§‹è³‡æ–™
  function findMatches(wordToMatch, cities) {

    // å›å‚³citiesçš„å­é›†åˆ(æœå°‹çµæœ?)
    return cities.filter(place => {
      // è™•ç†æ˜¯å¦æœ‰ç›¸ç¬¦åˆçš„åŸå¸‚æˆ–å·
      // ä½¿ç”¨æ­£è¦è¡¨ç¤ºæ³•(è¦éæ¿¾çš„å­—, è¦å‰‡)
      // g => global; 
      const regX = new RegExp(wordToMatch, 'gi');

      // å…¶ä¸­ç‚ºçœŸä¾¿ç‚ºçœŸ
      return place.city.match(regX) || place.state.match(regX);
    });
  }

  // æœ€å¾Œï¼Œå°‡äººå£æ•¸å­—åŠ ä¸Šé€—è™Ÿ(æ­£è¦è¡¨ç¤ºæ³•...)
  function numWithComma(num){
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }


  // å°‡ç¯©é¸å¥½çš„è³‡æ–™é¡¯ç¤ºå‡ºä¾†
  function displayMatches(){
    // ç•¶è¼¸å…¥æ¡†æœ‰æ”¹è®Šé€™è£¡æœƒè¢«å‘¼å«
    // æ‹¿åˆ°æœå°‹çµæœ
    const matchesArray = findMatches(this.value, cities);
    
    // æ”¹è®Šç•«é¢
    const htmlTags = matchesArray.map(place => {
      // highlight the search word
      // é€™è£¡çš„this.value => ä½¿ç”¨è€…è¼¸å…¥çš„å­—ä¸²
      // æ‰¾åˆ°ä½¿ç”¨è€…è¼¸å…¥çš„å­—ä¸²ï¼Œç„¶å¾Œæ›æˆæœ‰æ•ˆæœçš„span
      const regex = new RegExp(this.value, 'gi');
      const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
      const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
      return `
        <li>
          <span class="name">${cityName}, ${stateName}</span>
          <span class="population">${numWithComma(place.population)}</span>
        </li>
        `;
    }).join('');
    console.log(htmlTags);
    suggestions.innerHTML = htmlTags;
  }  

  // è¼¸å…¥æ¡†
  const searchInput = document.querySelector('.search');
  searchInput.addEventListener('change', displayMatches);
  searchInput.addEventListener('keyup', displayMatches);

  // æ¸…å–®é¡¯ç¤º
  const suggestions = document.querySelector('.suggestions');
  
  </script>
  </body>
</html>
